---
title: Setup & Configuration
description: Installation and configuration for Echo Next.js SDK
---

import { Callout } from 'fumadocs-ui/components/callout';
import { Tabs, Tab } from 'fumadocs-ui/components/tabs';

# Setup & Configuration

## Installation

<Tabs items={['npm', 'pnpm', 'yarn', 'bun']}>
  <Tab value="npm">
    ```bash
    npm install @merit-systems/echo-next-sdk ai
    ```
  </Tab>
  <Tab value="pnpm">
    ```bash
    pnpm add @merit-systems/echo-next-sdk ai
    ```
  </Tab>
  <Tab value="yarn">
    ```bash
    yarn add @merit-systems/echo-next-sdk ai
    ```
  </Tab>
  <Tab value="bun">
    ```bash
    bun add @merit-systems/echo-next-sdk ai
    ```
  </Tab>
</Tabs>

### Dependencies

**Required:**
- `@merit-systems/echo-next-sdk` - Next.js SDK with OAuth2 authentication  
- `ai` - Vercel AI SDK for streaming and model integration

**Peer Dependencies:**
- `next@>=15.0.0` - Next.js App Router support

<Callout type="warn">
The SDK requires Next.js 15 or higher for App Router compatibility and server component patterns.
</Callout>

## Basic Configuration

### Create Echo Instance

```typescript title="echo/index.ts"
import Echo from '@merit-systems/echo-next-sdk';

export const { 
  handlers, 
  isSignedIn, 
  getUser, 
  openai, 
  anthropic 
} = Echo({
  appId: 'your-echo-app-id' // Get from https://echo.merit.systems
});
```

### Configuration Options

<AutoTypeTable 
  path="../echo-next-sdk/src/types.ts" 
  name="EchoConfig" 
/>

**Configuration Parameters:**

- `appId` **(required)** - Your Echo application ID from the dashboard
- `basePath` *(optional)* - OAuth route path (default: `/api/echo`)  
- `baseRouterUrl` *(optional)* - Custom Echo router endpoint for LLM requests

### Advanced Configuration

```typescript title="echo/index.ts"
export const { handlers, isSignedIn, openai, anthropic } = Echo({
  appId: process.env.ECHO_APP_ID!,
  basePath: '/api/auth/echo',           // Custom OAuth path
  baseRouterUrl: 'https://custom.echo.merit.systems' // Custom endpoint
});
```

## OAuth Route Setup

### API Route Handler

Create the catch-all OAuth route:

```typescript title="app/api/echo/[...echo]/route.ts"
import Echo from '@merit-systems/echo-next-sdk';

const { handlers } = Echo({ appId: 'your-echo-app-id' });

export const { GET, POST } = handlers;
```

This handles three OAuth endpoints:
- `GET /api/echo/signin` - Initiates OAuth2 + PKCE flow
- `GET /api/echo/callback` - Processes authorization code exchange  
- `POST /api/echo/refresh` - Refreshes expired access tokens

### Custom Base Path

If using custom `basePath`, update the route location:

```typescript title="echo/index.ts"
const echo = Echo({
  appId: 'your-app-id',
  basePath: '/api/auth/echo'
});
```

```typescript title="app/api/auth/echo/[...echo]/route.ts"
import Echo from '@merit-systems/echo-next-sdk';

const { handlers } = Echo({ 
  appId: 'your-echo-app-id',
  basePath: '/api/auth/echo'
});

export const { GET, POST } = handlers;
```

## Environment Variables

### Required Environment

```bash title=".env.local"
ECHO_APP_ID=your-echo-app-id
```

### Optional Configuration

```bash title=".env.local"
ECHO_APP_ID=your-echo-app-id
ECHO_BASE_PATH=/api/echo
ECHO_ROUTER_URL=https://echo.router.merit.systems
```

### TypeScript Environment Types

```typescript title="env.d.ts"
declare namespace NodeJS {
  interface ProcessEnv {
    ECHO_APP_ID: string;
    ECHO_BASE_PATH?: string;
    ECHO_ROUTER_URL?: string;
  }
}
```

## Echo App Configuration

### OAuth Callback URLs

Configure authorized callback URLs in your Echo app dashboard:

- **Development**: `http://localhost:3000/api/echo/callback`
- **Production**: `https://yourdomain.com/api/echo/callback`

<Callout type="info">
The callback URL must match your `basePath` configuration. Default is `/api/echo/callback`.
</Callout>

### App Settings

Required Echo app configuration:
- **App Type**: Web application
- **OAuth Flow**: Authorization Code with PKCE
- **Token Endpoint Auth**: None (public client)

## Project Structure

### Recommended File Organization

```
app/
├── api/
│   └── echo/
│       └── [...echo]/
│           └── route.ts          # OAuth handlers
├── components/
│   └── sign-in.tsx              # Authentication UI
└── page.tsx                     # Main page with auth check

echo/
└── index.ts                     # Echo configuration

env.d.ts                         # Environment types
.env.local                       # Environment variables
```

### TypeScript Configuration

Ensure your `tsconfig.json` supports App Router patterns:

```json title="tsconfig.json"
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["dom", "dom.iterable", "ES6"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [{ "name": "next" }],
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"],
      "@/echo": ["./echo"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

## Next.js Configuration

### App Router Requirements

The SDK requires Next.js 15+ App Router. Ensure your `next.config.ts`:

```typescript title="next.config.ts"
import type { NextConfig } from 'next';

const nextConfig: NextConfig = {
  experimental: {
    serverComponentsExternalPackages: ['@merit-systems/echo-next-sdk']
  }
};

export default nextConfig;
```

### Middleware Integration

If using Next.js middleware, ensure OAuth routes are excluded:

```typescript title="middleware.ts"
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // Skip Echo OAuth routes
  if (request.nextUrl.pathname.startsWith('/api/echo/')) {
    return NextResponse.next();
  }
  
  // Your middleware logic
}

export const config = {
  matcher: ['/((?!api/echo|_next/static|_next/image|favicon.ico).*)']
};
```

## Verification

### Test OAuth Flow

1. Start your Next.js development server
2. Navigate to `/api/echo/signin`
3. Should redirect to Echo authorization server
4. After authorization, should redirect back with tokens set

### Debug Configuration

```typescript title="echo/debug.ts"
import Echo from '@merit-systems/echo-next-sdk';

const { isSignedIn, getUser } = Echo({ appId: 'your-echo-app-id' });

export async function debugAuth() {
  console.log('Authenticated:', await isSignedIn());
  console.log('User:', await getUser());
}
```

<Callout type="info">
OAuth cookies are HTTP-only and secure. Use server-side functions `isSignedIn()` and `getUser()` to check authentication state.
</Callout>