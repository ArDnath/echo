---
title: Authentication
description: Minimal setup for Echo OAuth routes and cookie-based auth
---

import { Callout } from 'fumadocs-ui/components/callout';

# Authentication

Echo uses a single catch-all route to handle OAuth and stores tokens in secure HTTP‑only cookies. You wire up the route once, then use cookies server-side to check auth and fetch the user.

## Required catch‑all route

```typescript title="app/api/echo/[...echo]/route.ts"
import { handlers } from '@/echo';

export const { GET, POST } = handlers;
```

If you customize the base path, place the route accordingly (for example `app/api/auth/echo/[...echo]/route.ts`) and pass `basePath` to `Echo({ basePath: '/api/auth/echo' })`.

## What the internal endpoints do

- **GET /api/echo/signin**: Starts OAuth with PKCE and redirects to Echo. Sets `echo_code_verifier` (HTTP‑only, 5‑minute TTL) so the callback can verify the exchange.
- **GET /api/echo/callback**: Exchanges the authorization code for tokens, clears `echo_code_verifier`, and sets:
  - `echo_access_token`
  - `echo_refresh_token`
  - `echo_refresh_token_expires`
  All are HTTP‑only, `sameSite: 'lax'`, `path: '/'`, and `secure` in production.
- **POST /api/echo/refresh**: Used internally by the SDK to refresh access tokens when needed.

<Callout type="info">
You do not implement these routes yourself—`handlers` wires them up for you.
</Callout>

## Cookie‑based auth plumbing

Tokens live in cookies, so server code can read auth without exposing tokens to the client.

```typescript
import Echo from '@merit-systems/echo-next-sdk';

const { isSignedIn, getUser } = Echo({ appId: 'your-echo-app-id' });

export default async function Page() {
  if (!(await isSignedIn())) return <SignIn/>;
  const user = await getUser();
  return <Dashboard user={user}/>;
}
```

- **`isSignedIn()`**: Fast server‑side check based on cookies; no network if the refresh token is still valid.
- **`getUser()`**: Uses the access token from cookies; the SDK refreshes tokens when needed and updates cookies.

Client components can initiate sign‑in with a redirect:

```typescript
import { signIn } from '@merit-systems/echo-next-sdk/client';

<button onClick={() => signIn()}>Sign in with Echo</button>
```

That’s it—ensure the catch‑all route exists, and the SDK handles token cookies and refresh for you.